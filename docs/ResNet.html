---

title: ResNet 

keywords: fastai
sidebar: home_sidebar

summary: "Fully implemented ResNet architecture from scratch: https://arxiv.org/pdf/1512.03385.pdf"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: ResNet.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
    
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Helper">Helper<a class="anchor-link" href="#Helper">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_runner" class="doc_header"><code>get_runner</code><a href="https://github.com/BradleyBrown19/ModernArchitecturesFromScratch/tree/master/ModernArchitecturesFromScratch/callbacks_05.py#L159" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_runner</code>(<strong><code>callbacks</code></strong>=<em><code>None</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Nested-Modules">Nested Modules<a class="anchor-link" href="#Nested-Modules">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We first need to make new classes that allow architectures that aren't straight forward passes through a defined set of layers. This is normally handled in the forward passes of pytorch with autograd. We need to be a bit more clever due to the fact that we need to define our gradients in each module.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="NestedModel" class="doc_header"><code>class</code> <code>NestedModel</code><a href="https://github.com/BradleyBrown19/ModernArchitecturesFromScratch/tree/master/ModernArchitecturesFromScratch/resnet_08.py#L27" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>NestedModel</code>() :: <a href="/ModernArchitecturesFromScratch/ModelTraining#Module"><code>Module</code></a></p>
</blockquote>
<p>NestModel that allows for a sequential model to be called withing an outer model</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="TestMixingGrads" class="doc_header"><code>class</code> <code>TestMixingGrads</code><a href="https://github.com/BradleyBrown19/ModernArchitecturesFromScratch/tree/master/ModernArchitecturesFromScratch/resnet_08.py#L42" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>TestMixingGrads</code>() :: <a href="/ModernArchitecturesFromScratch/ResNet#NestedModel"><code>NestedModel</code></a></p>
</blockquote>
<p>Test module to see if nested SequentialModels will work</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Testing the gradients and the outputs:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">m</span> <span class="o">=</span> <span class="n">SequentialModel</span><span class="p">(</span><span class="n">TestMixingGrads</span><span class="p">(),</span> <span class="n">Linear</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
<span class="n">db</span> <span class="o">=</span> <span class="n">get_mnist_databunch</span><span class="p">()</span>
<span class="n">lf</span> <span class="o">=</span> <span class="n">CrossEntropy</span><span class="p">()</span>
<span class="n">optimizer</span> <span class="o">=</span> <span class="n">adam_opt</span><span class="p">()</span>
<span class="n">m</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(Layer1): 
SubModel( 
(Layer1): Linear(784, 50)
(Layer2): ReLU()
(Layer3): Linear(50, 25)
)
(Layer2): Linear(25, 10)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span> <span class="o">=</span> <span class="n">Learner</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">CrossEntropy</span><span class="p">(),</span> <span class="n">Optimizer</span><span class="p">,</span> <span class="n">db</span><span class="p">)</span>
<span class="n">run</span> <span class="o">=</span> <span class="n">Runner</span><span class="p">(</span><span class="n">learn</span><span class="p">,</span> <span class="p">[</span><span class="n">CheckGrad</span><span class="p">()])</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">run</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mf">0.1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>good
good
good
good
good
good
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Refactored-Conv-Layers">Refactored Conv Layers<a class="anchor-link" href="#Refactored-Conv-Layers">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Before we can start making ResNets, we first define a few helper modules that abstract some of the layers:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="AutoConv" class="doc_header"><code>class</code> <code>AutoConv</code><a href="https://github.com/BradleyBrown19/ModernArchitecturesFromScratch/tree/master/ModernArchitecturesFromScratch/resnet_08.py#L49" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>AutoConv</code>(<strong><code>n_in</code></strong>, <strong><code>n_out</code></strong>, <strong><code>kernel_size</code></strong>=<em><code>3</code></em>, <strong><code>stride</code></strong>=<em><code>1</code></em>) :: <a href="/ModernArchitecturesFromScratch/Convolutions&amp;Pooling#Conv"><code>Conv</code></a></p>
</blockquote>
<p>Automatic resizing of padding based on kernel size to ensure constant dimensions of input to output</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="ConvBatch" class="doc_header"><code>class</code> <code>ConvBatch</code><a href="https://github.com/BradleyBrown19/ModernArchitecturesFromScratch/tree/master/ModernArchitecturesFromScratch/resnet_08.py#L56" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>ConvBatch</code>(<strong><code>n_in</code></strong>, <strong><code>n_out</code></strong>, <strong><code>kernel_size</code></strong>=<em><code>3</code></em>, <strong><code>stride</code></strong>=<em><code>1</code></em>, <strong>**<code>kwargs</code></strong>) :: <a href="/ModernArchitecturesFromScratch/ResNet#NestedModel"><code>NestedModel</code></a></p>
</blockquote>
<p>Performs conv then batchnorm</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="Identity" class="doc_header"><code>class</code> <code>Identity</code><a href="https://github.com/BradleyBrown19/ModernArchitecturesFromScratch/tree/master/ModernArchitecturesFromScratch/resnet_08.py#L65" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>Identity</code>() :: <a href="/ModernArchitecturesFromScratch/ModelTraining#Module"><code>Module</code></a></p>
</blockquote>
<p>Module to perform the identity connection (what goes in, comes out)</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="ResBlocks">ResBlocks<a class="anchor-link" href="#ResBlocks">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Final built up ResNet blocks that implement the skip connecton layers characteristic of a ResNet</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="BasicRes" class="doc_header"><code>class</code> <code>BasicRes</code><a href="https://github.com/BradleyBrown19/ModernArchitecturesFromScratch/tree/master/ModernArchitecturesFromScratch/resnet_08.py#L72" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>BasicRes</code>(<strong><code>n_in</code></strong>, <strong><code>n_out</code></strong>, <strong><code>expansion</code></strong>=<em><code>1</code></em>, <strong><code>stride</code></strong>=<em><code>1</code></em>, <strong><code>Activation</code></strong>=<em><code>'ReLU'</code></em>, <strong>*<code>args</code></strong>, <strong>**<code>kwargs</code></strong>) :: <a href="/ModernArchitecturesFromScratch/ModelTraining#Module"><code>Module</code></a></p>
</blockquote>
<p>Defines a base class for all layers of the network. Allows for easy implementation of forward and backward passes as well as updating learnable parameters</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="BasicResBlock" class="doc_header"><code>class</code> <code>BasicResBlock</code><a href="https://github.com/BradleyBrown19/ModernArchitecturesFromScratch/tree/master/ModernArchitecturesFromScratch/resnet_08.py#L103" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>BasicResBlock</code>(<strong><code>n_in</code></strong>, <strong><code>n_out</code></strong>, <strong>*<code>args</code></strong>, <strong>**<code>kwargs</code></strong>) :: <a href="/ModernArchitecturesFromScratch/ResNet#BasicRes"><code>BasicRes</code></a></p>
</blockquote>
<p>Defines a base class for all layers of the network. Allows for easy implementation of forward and backward passes as well as updating learnable parameters</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="BottleneckBlock" class="doc_header"><code>class</code> <code>BottleneckBlock</code><a href="https://github.com/BradleyBrown19/ModernArchitecturesFromScratch/tree/master/ModernArchitecturesFromScratch/resnet_08.py#L118" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>BottleneckBlock</code>(<strong><code>n_in</code></strong>, <strong><code>n_out</code></strong>, <strong>*<code>args</code></strong>, <strong>**<code>kwargs</code></strong>) :: <a href="/ModernArchitecturesFromScratch/ResNet#BasicRes"><code>BasicRes</code></a></p>
</blockquote>
<p>Defines a base class for all layers of the network. Allows for easy implementation of forward and backward passes as well as updating learnable parameters</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="ResBlock" class="doc_header"><code>class</code> <code>ResBlock</code><a href="https://github.com/BradleyBrown19/ModernArchitecturesFromScratch/tree/master/ModernArchitecturesFromScratch/resnet_08.py#L133" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>ResBlock</code>(<strong><code>n_in</code></strong>, <strong><code>n_out</code></strong>, <strong><code>block</code></strong>=<em><code>'BasicResBlock'</code></em>, <strong><code>stride</code></strong>=<em><code>1</code></em>, <strong><code>kernel_size</code></strong>=<em><code>3</code></em>, <strong><code>Activation</code></strong>=<em><code>'ReLU'</code></em>, <strong>**<code>kwargs</code></strong>) :: <a href="/ModernArchitecturesFromScratch/ResNet#NestedModel"><code>NestedModel</code></a></p>
</blockquote>
<p>Adds the final activation after the skip connection addition</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="ResLayer" class="doc_header"><code>class</code> <code>ResLayer</code><a href="https://github.com/BradleyBrown19/ModernArchitecturesFromScratch/tree/master/ModernArchitecturesFromScratch/resnet_08.py#L145" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>ResLayer</code>(<strong><code>block</code></strong>, <strong><code>n</code></strong>, <strong><code>n_in</code></strong>, <strong><code>n_out</code></strong>, <strong>*<code>args</code></strong>, <strong>**<code>kwargs</code></strong>) :: <a href="/ModernArchitecturesFromScratch/ResNet#NestedModel"><code>NestedModel</code></a></p>
</blockquote>
<p>Sequential res layers</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="ResNet">ResNet<a class="anchor-link" href="#ResNet">&#182;</a></h1>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="ResNet" class="doc_header"><code>class</code> <code>ResNet</code><a href="https://github.com/BradleyBrown19/ModernArchitecturesFromScratch/tree/master/ModernArchitecturesFromScratch/resnet_08.py#L162" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>ResNet</code>(<strong><code>block</code></strong>, <strong><code>layer_sizes</code></strong>=<em><code>[64, 128, 256, 512]</code></em>, <strong><code>depths</code></strong>=<em><code>[2, 2, 2, 2]</code></em>, <strong><code>c_in</code></strong>=<em><code>3</code></em>, <strong><code>c_out</code></strong>=<em><code>1000</code></em>, <strong><code>im_size</code></strong>=<em><code>(28, 28)</code></em>, <strong><code>activation</code></strong>=<em><code>'ReLU'</code></em>, <strong>*<code>args</code></strong>, <strong>**<code>kwargs</code></strong>) :: <a href="/ModernArchitecturesFromScratch/ResNet#NestedModel"><code>NestedModel</code></a></p>
</blockquote>
<p>Class to create ResNet architectures of dynamic sizing</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">res</span> <span class="o">=</span> <span class="n">ResNet</span><span class="p">(</span><span class="n">BasicResBlock</span><span class="p">)</span>
<span class="n">res</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>ResNet: 
(Layer1): Reshape(3, 28, 28)
(Layer2): Conv(3, 64, ks = 7, stride = 2), Batchnorm
(Layer3): ReLU()
(Layer4): MaxPool(ks: 3, stride: 2)
(Layer5): ResLayer(
(Layer1): ResBlock(64, 64, kernel_size=3, stride=1)
(Layer2): ResBlock(64, 64, kernel_size=3, stride=1)
)
(Layer6): ResLayer(
(Layer1): ResBlock(64, 128, kernel_size=3, stride=2)
(Layer2): ResBlock(128, 128, kernel_size=3, stride=1)
)
(Layer7): ResLayer(
(Layer1): ResBlock(128, 256, kernel_size=3, stride=2)
(Layer2): ResBlock(256, 256, kernel_size=3, stride=1)
)
(Layer8): ResLayer(
(Layer1): ResBlock(256, 512, kernel_size=3, stride=2)
(Layer2): ResBlock(512, 512, kernel_size=3, stride=1)
)
(Layer9): AveragePool(ks: 1, stride: 1)
(Layer10): Flatten()
(Layer11): Linear(512, 1000)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="GetResnet" class="doc_header"><code>GetResnet</code><a href="https://github.com/BradleyBrown19/ModernArchitecturesFromScratch/tree/master/ModernArchitecturesFromScratch/resnet_08.py#L198" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>GetResnet</code>(<strong><code>size</code></strong>, <strong><code>c_in</code></strong>=<em><code>3</code></em>, <strong><code>c_out</code></strong>=<em><code>10</code></em>, <strong>*<code>args</code></strong>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>
<p>Helper function to get ResNet architectures of different sizes</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Testing out the ResNet Architectures:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">GetResnet</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="n">c_in</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">c_out</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>ResNet: 
(Layer1): Reshape(1, 28, 28)
(Layer2): Conv(1, 64, ks = 7, stride = 2), Batchnorm
(Layer3): ReLU()
(Layer4): MaxPool(ks: 3, stride: 2)
(Layer5): ResLayer(
(Layer1): ResBlock(64, 64, kernel_size=3, stride=1)
(Layer2): ResBlock(64, 64, kernel_size=3, stride=1)
)
(Layer6): ResLayer(
(Layer1): ResBlock(64, 128, kernel_size=3, stride=2)
(Layer2): ResBlock(128, 128, kernel_size=3, stride=1)
)
(Layer7): ResLayer(
(Layer1): ResBlock(128, 256, kernel_size=3, stride=2)
(Layer2): ResBlock(256, 256, kernel_size=3, stride=1)
)
(Layer8): ResLayer(
(Layer1): ResBlock(256, 512, kernel_size=3, stride=2)
(Layer2): ResBlock(512, 512, kernel_size=3, stride=1)
)
(Layer9): AveragePool(ks: 1, stride: 1)
(Layer10): Flatten()
(Layer11): Linear(512, 10)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">GetResnet</span><span class="p">(</span><span class="mi">34</span><span class="p">,</span> <span class="n">c_in</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">c_out</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>ResNet: 
(Layer1): Reshape(1, 28, 28)
(Layer2): Conv(1, 64, ks = 7, stride = 2), Batchnorm
(Layer3): ReLU()
(Layer4): MaxPool(ks: 3, stride: 2)
(Layer5): ResLayer(
(Layer1): ResBlock(64, 64, kernel_size=3, stride=1)
(Layer2): ResBlock(64, 64, kernel_size=3, stride=1)
(Layer3): ResBlock(64, 64, kernel_size=3, stride=1)
)
(Layer6): ResLayer(
(Layer1): ResBlock(64, 128, kernel_size=3, stride=2)
(Layer2): ResBlock(128, 128, kernel_size=3, stride=1)
(Layer3): ResBlock(128, 128, kernel_size=3, stride=1)
(Layer4): ResBlock(128, 128, kernel_size=3, stride=1)
)
(Layer7): ResLayer(
(Layer1): ResBlock(128, 256, kernel_size=3, stride=2)
(Layer2): ResBlock(256, 256, kernel_size=3, stride=1)
(Layer3): ResBlock(256, 256, kernel_size=3, stride=1)
(Layer4): ResBlock(256, 256, kernel_size=3, stride=1)
(Layer5): ResBlock(256, 256, kernel_size=3, stride=1)
(Layer6): ResBlock(256, 256, kernel_size=3, stride=1)
)
(Layer8): ResLayer(
(Layer1): ResBlock(256, 512, kernel_size=3, stride=2)
(Layer2): ResBlock(512, 512, kernel_size=3, stride=1)
(Layer3): ResBlock(512, 512, kernel_size=3, stride=1)
)
(Layer9): AveragePool(ks: 1, stride: 1)
(Layer10): Flatten()
(Layer11): Linear(512, 10)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">GetResnet</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="n">c_in</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">c_out</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>ResNet: 
(Layer1): Reshape(1, 28, 28)
(Layer2): Conv(1, 64, ks = 7, stride = 2), Batchnorm
(Layer3): ReLU()
(Layer4): MaxPool(ks: 3, stride: 2)
(Layer5): ResLayer(
(Layer1): ResBlock(64, 256, kernel_size=3, stride=1)
(Layer2): ResBlock(256, 256, kernel_size=3, stride=1)
(Layer3): ResBlock(256, 256, kernel_size=3, stride=1)
)
(Layer6): ResLayer(
(Layer1): ResBlock(256, 512, kernel_size=3, stride=2)
(Layer2): ResBlock(512, 512, kernel_size=3, stride=1)
(Layer3): ResBlock(512, 512, kernel_size=3, stride=1)
(Layer4): ResBlock(512, 512, kernel_size=3, stride=1)
)
(Layer7): ResLayer(
(Layer1): ResBlock(512, 1024, kernel_size=3, stride=2)
(Layer2): ResBlock(1024, 1024, kernel_size=3, stride=1)
(Layer3): ResBlock(1024, 1024, kernel_size=3, stride=1)
(Layer4): ResBlock(1024, 1024, kernel_size=3, stride=1)
(Layer5): ResBlock(1024, 1024, kernel_size=3, stride=1)
(Layer6): ResBlock(1024, 1024, kernel_size=3, stride=1)
)
(Layer8): ResLayer(
(Layer1): ResBlock(1024, 2048, kernel_size=3, stride=2)
(Layer2): ResBlock(2048, 2048, kernel_size=3, stride=1)
(Layer3): ResBlock(2048, 2048, kernel_size=3, stride=1)
)
(Layer9): AveragePool(ks: 1, stride: 1)
(Layer10): Flatten()
(Layer11): Linear(2048, 10)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">GetResnet</span><span class="p">(</span><span class="mi">150</span><span class="p">,</span> <span class="n">c_in</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">c_out</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>ResNet: 
(Layer1): Reshape(1, 28, 28)
(Layer2): Conv(1, 64, ks = 7, stride = 2), Batchnorm
(Layer3): ReLU()
(Layer4): MaxPool(ks: 3, stride: 2)
(Layer5): ResLayer(
(Layer1): ResBlock(64, 256, kernel_size=3, stride=1)
(Layer2): ResBlock(256, 256, kernel_size=3, stride=1)
(Layer3): ResBlock(256, 256, kernel_size=3, stride=1)
)
(Layer6): ResLayer(
(Layer1): ResBlock(256, 512, kernel_size=3, stride=2)
(Layer2): ResBlock(512, 512, kernel_size=3, stride=1)
(Layer3): ResBlock(512, 512, kernel_size=3, stride=1)
(Layer4): ResBlock(512, 512, kernel_size=3, stride=1)
)
(Layer7): ResLayer(
(Layer1): ResBlock(512, 1024, kernel_size=3, stride=2)
(Layer2): ResBlock(1024, 1024, kernel_size=3, stride=1)
(Layer3): ResBlock(1024, 1024, kernel_size=3, stride=1)
(Layer4): ResBlock(1024, 1024, kernel_size=3, stride=1)
(Layer5): ResBlock(1024, 1024, kernel_size=3, stride=1)
(Layer6): ResBlock(1024, 1024, kernel_size=3, stride=1)
(Layer7): ResBlock(1024, 1024, kernel_size=3, stride=1)
(Layer8): ResBlock(1024, 1024, kernel_size=3, stride=1)
(Layer9): ResBlock(1024, 1024, kernel_size=3, stride=1)
(Layer10): ResBlock(1024, 1024, kernel_size=3, stride=1)
(Layer11): ResBlock(1024, 1024, kernel_size=3, stride=1)
(Layer12): ResBlock(1024, 1024, kernel_size=3, stride=1)
(Layer13): ResBlock(1024, 1024, kernel_size=3, stride=1)
(Layer14): ResBlock(1024, 1024, kernel_size=3, stride=1)
(Layer15): ResBlock(1024, 1024, kernel_size=3, stride=1)
(Layer16): ResBlock(1024, 1024, kernel_size=3, stride=1)
(Layer17): ResBlock(1024, 1024, kernel_size=3, stride=1)
(Layer18): ResBlock(1024, 1024, kernel_size=3, stride=1)
(Layer19): ResBlock(1024, 1024, kernel_size=3, stride=1)
(Layer20): ResBlock(1024, 1024, kernel_size=3, stride=1)
(Layer21): ResBlock(1024, 1024, kernel_size=3, stride=1)
(Layer22): ResBlock(1024, 1024, kernel_size=3, stride=1)
(Layer23): ResBlock(1024, 1024, kernel_size=3, stride=1)
)
(Layer8): ResLayer(
(Layer1): ResBlock(1024, 2048, kernel_size=3, stride=2)
(Layer2): ResBlock(2048, 2048, kernel_size=3, stride=1)
(Layer3): ResBlock(2048, 2048, kernel_size=3, stride=1)
)
(Layer9): AveragePool(ks: 1, stride: 1)
(Layer10): Flatten()
(Layer11): Linear(2048, 10)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">GetResnet</span><span class="p">(</span><span class="mi">152</span><span class="p">,</span> <span class="n">c_in</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">c_out</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>ResNet: 
(Layer1): Reshape(1, 28, 28)
(Layer2): Conv(1, 64, ks = 7, stride = 2), Batchnorm
(Layer3): ReLU()
(Layer4): MaxPool(ks: 3, stride: 2)
(Layer5): ResLayer(
(Layer1): ResBlock(64, 256, kernel_size=3, stride=1)
(Layer2): ResBlock(256, 256, kernel_size=3, stride=1)
(Layer3): ResBlock(256, 256, kernel_size=3, stride=1)
)
(Layer6): ResLayer(
(Layer1): ResBlock(256, 512, kernel_size=3, stride=2)
(Layer2): ResBlock(512, 512, kernel_size=3, stride=1)
(Layer3): ResBlock(512, 512, kernel_size=3, stride=1)
(Layer4): ResBlock(512, 512, kernel_size=3, stride=1)
(Layer5): ResBlock(512, 512, kernel_size=3, stride=1)
(Layer6): ResBlock(512, 512, kernel_size=3, stride=1)
(Layer7): ResBlock(512, 512, kernel_size=3, stride=1)
(Layer8): ResBlock(512, 512, kernel_size=3, stride=1)
)
(Layer7): ResLayer(
(Layer1): ResBlock(512, 1024, kernel_size=3, stride=2)
(Layer2): ResBlock(1024, 1024, kernel_size=3, stride=1)
(Layer3): ResBlock(1024, 1024, kernel_size=3, stride=1)
(Layer4): ResBlock(1024, 1024, kernel_size=3, stride=1)
(Layer5): ResBlock(1024, 1024, kernel_size=3, stride=1)
(Layer6): ResBlock(1024, 1024, kernel_size=3, stride=1)
(Layer7): ResBlock(1024, 1024, kernel_size=3, stride=1)
(Layer8): ResBlock(1024, 1024, kernel_size=3, stride=1)
(Layer9): ResBlock(1024, 1024, kernel_size=3, stride=1)
(Layer10): ResBlock(1024, 1024, kernel_size=3, stride=1)
(Layer11): ResBlock(1024, 1024, kernel_size=3, stride=1)
(Layer12): ResBlock(1024, 1024, kernel_size=3, stride=1)
(Layer13): ResBlock(1024, 1024, kernel_size=3, stride=1)
(Layer14): ResBlock(1024, 1024, kernel_size=3, stride=1)
(Layer15): ResBlock(1024, 1024, kernel_size=3, stride=1)
(Layer16): ResBlock(1024, 1024, kernel_size=3, stride=1)
(Layer17): ResBlock(1024, 1024, kernel_size=3, stride=1)
(Layer18): ResBlock(1024, 1024, kernel_size=3, stride=1)
(Layer19): ResBlock(1024, 1024, kernel_size=3, stride=1)
(Layer20): ResBlock(1024, 1024, kernel_size=3, stride=1)
(Layer21): ResBlock(1024, 1024, kernel_size=3, stride=1)
(Layer22): ResBlock(1024, 1024, kernel_size=3, stride=1)
(Layer23): ResBlock(1024, 1024, kernel_size=3, stride=1)
(Layer24): ResBlock(1024, 1024, kernel_size=3, stride=1)
(Layer25): ResBlock(1024, 1024, kernel_size=3, stride=1)
(Layer26): ResBlock(1024, 1024, kernel_size=3, stride=1)
(Layer27): ResBlock(1024, 1024, kernel_size=3, stride=1)
(Layer28): ResBlock(1024, 1024, kernel_size=3, stride=1)
(Layer29): ResBlock(1024, 1024, kernel_size=3, stride=1)
(Layer30): ResBlock(1024, 1024, kernel_size=3, stride=1)
(Layer31): ResBlock(1024, 1024, kernel_size=3, stride=1)
(Layer32): ResBlock(1024, 1024, kernel_size=3, stride=1)
(Layer33): ResBlock(1024, 1024, kernel_size=3, stride=1)
(Layer34): ResBlock(1024, 1024, kernel_size=3, stride=1)
(Layer35): ResBlock(1024, 1024, kernel_size=3, stride=1)
(Layer36): ResBlock(1024, 1024, kernel_size=3, stride=1)
)
(Layer8): ResLayer(
(Layer1): ResBlock(1024, 2048, kernel_size=3, stride=2)
(Layer2): ResBlock(2048, 2048, kernel_size=3, stride=1)
(Layer3): ResBlock(2048, 2048, kernel_size=3, stride=1)
)
(Layer9): AveragePool(ks: 1, stride: 1)
(Layer10): Flatten()
(Layer11): Linear(2048, 10)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">run</span> <span class="o">=</span> <span class="n">get_runner</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">GetResnet</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="n">c_in</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">c_out</span><span class="o">=</span><span class="mi">10</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>
 

