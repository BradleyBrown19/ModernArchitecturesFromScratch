---

title: Title

keywords: fastai
sidebar: home_sidebar

summary: "summary"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: FullyConnectedNetwork.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
    
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Data-Loading">Data Loading<a class="anchor-link" href="#Data-Loading">&#182;</a></h1>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="normalize" class="doc_header"><code>normalize</code><a href="https://github.com/BradleyBrown19/ModernArchitecuturesFromScratch/tree/master/ModernArchitecuturesFromScratch/fully_connected_network_02.py#L11" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>normalize</code>(<strong><code>datasets</code></strong>, <strong><code>mean</code></strong>=<em><code>None</code></em>, <strong><code>std</code></strong>=<em><code>None</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_mnist" class="doc_header"><code>get_mnist</code><a href="https://github.com/BradleyBrown19/ModernArchitecuturesFromScratch/tree/master/ModernArchitecuturesFromScratch/fully_connected_network_02.py#L17" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_mnist</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">xt</span><span class="p">,</span><span class="n">yt</span><span class="p">,</span><span class="n">xv</span><span class="p">,</span><span class="n">yv</span> <span class="o">=</span> <span class="n">get_mnist</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">n_out</span> <span class="o">=</span> <span class="p">(</span><span class="n">yt</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
<span class="n">n_in</span> <span class="o">=</span> <span class="p">(</span><span class="n">xt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="test_near_zero" class="doc_header"><code>test_near_zero</code><a href="https://github.com/BradleyBrown19/ModernArchitecuturesFromScratch/tree/master/ModernArchitecuturesFromScratch/fully_connected_network_02.py#L26" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>test_near_zero</code>(<strong><code>data</code></strong>, <strong><code>tol</code></strong>=<em><code>0.001</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_near_zero</span><span class="p">(</span><span class="n">xt</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Near zero: 0.00012300178059376776
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">show_im</span><span class="p">(</span><span class="n">xt</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
"
>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Helper-Functions">Helper Functions<a class="anchor-link" href="#Helper-Functions">&#182;</a></h1>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_stats" class="doc_header"><code>get_stats</code><a href="https://github.com/BradleyBrown19/ModernArchitecuturesFromScratch/tree/master/ModernArchitecuturesFromScratch/fully_connected_network_02.py#L29" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_stats</code>(<strong><code>data</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_weight" class="doc_header"><code>get_weight</code><a href="https://github.com/BradleyBrown19/ModernArchitecuturesFromScratch/tree/master/ModernArchitecuturesFromScratch/fully_connected_network_02.py#L36" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_weight</code>(<strong><code>in_d</code></strong>, <strong><code>out_d</code></strong>, <strong><code>final</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="linear" class="doc_header"><code>linear</code><a href="https://github.com/BradleyBrown19/ModernArchitecuturesFromScratch/tree/master/ModernArchitecuturesFromScratch/fully_connected_network_02.py#L40" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>linear</code>(<strong><code>x</code></strong>, <strong><code>w</code></strong>, <strong><code>b</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Forward-Pass">Forward Pass<a class="anchor-link" href="#Forward-Pass">&#182;</a></h1>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="relu" class="doc_header"><code>relu</code><a href="https://github.com/BradleyBrown19/ModernArchitecuturesFromScratch/tree/master/ModernArchitecuturesFromScratch/fully_connected_network_02.py#L43" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>relu</code>(<strong><code>x</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="lin_rel" class="doc_header"><code>lin_rel</code><a href="https://github.com/BradleyBrown19/ModernArchitecuturesFromScratch/tree/master/ModernArchitecuturesFromScratch/fully_connected_network_02.py#L45" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>lin_rel</code>(<strong><code>x</code></strong>, <strong><code>w</code></strong>, <strong><code>b</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="softmax" class="doc_header"><code>softmax</code><a href="https://github.com/BradleyBrown19/ModernArchitecuturesFromScratch/tree/master/ModernArchitecuturesFromScratch/fully_connected_network_02.py#L47" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>softmax</code>(<strong><code>x</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">n_in</span> <span class="o">=</span> <span class="mi">28</span><span class="o">**</span><span class="mi">2</span>
<span class="n">n_out</span> <span class="o">=</span> <span class="mi">10</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">w1</span> <span class="o">=</span> <span class="n">get_weight</span><span class="p">(</span><span class="n">n_in</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">w2</span> <span class="o">=</span> <span class="n">get_weight</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="n">n_out</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">b1</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
<span class="n">b2</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_out</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">forward_pass</span><span class="p">(</span><span class="n">xb</span><span class="p">):</span>
    <span class="n">xb</span> <span class="o">=</span> <span class="n">lin_rel</span><span class="p">(</span><span class="n">xb</span><span class="p">,</span> <span class="n">w1</span><span class="p">,</span> <span class="n">b1</span><span class="p">)</span>
    <span class="n">xb</span> <span class="o">=</span> <span class="n">linear</span><span class="p">(</span><span class="n">xb</span><span class="p">,</span> <span class="n">w2</span><span class="p">,</span> <span class="n">b2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">xb</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">forward_pass</span><span class="p">(</span><span class="n">xt</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">get_stats</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Mean: 0.08484654873609543
Std: 0.7059754729270935
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Loss">Loss<a class="anchor-link" href="#Loss">&#182;</a></h1>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="mse_loss" class="doc_header"><code>mse_loss</code><a href="https://github.com/BradleyBrown19/ModernArchitecuturesFromScratch/tree/master/ModernArchitecuturesFromScratch/fully_connected_network_02.py#L50" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>mse_loss</code>(<strong><code>xb</code></strong>, <strong><code>yb</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">eps</span> <span class="o">=</span> <span class="mf">1e-9</span>
<span class="k">def</span> <span class="nf">cross_entropy</span><span class="p">(</span><span class="n">xb</span><span class="p">,</span> <span class="n">targ</span><span class="p">):</span> <span class="k">return</span> <span class="o">-</span><span class="p">(</span> <span class="p">(</span><span class="n">xb</span> <span class="o">+</span> <span class="n">eps</span><span class="p">)</span><span class="o">.</span><span class="n">log</span><span class="p">()[</span><span class="nb">range</span><span class="p">(</span><span class="n">targ</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">targ</span><span class="o">.</span><span class="n">long</span><span class="p">()]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Backwards-Pass">Backwards Pass<a class="anchor-link" href="#Backwards-Pass">&#182;</a></h1>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">mse_grad</span><span class="p">(</span><span class="n">inp</span><span class="p">,</span> <span class="n">targ</span><span class="p">):</span>
    <span class="n">inp</span><span class="o">.</span><span class="n">g</span> <span class="o">=</span> <span class="mf">2.</span> <span class="o">*</span> <span class="p">(</span><span class="n">inp</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">targ</span><span class="p">)</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">inp</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">rel_grad</span><span class="p">(</span><span class="n">inp</span><span class="p">,</span> <span class="n">out</span><span class="p">):</span>
    <span class="n">inp</span><span class="o">.</span><span class="n">g</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">g</span> <span class="o">*</span> <span class="p">(</span><span class="n">inp</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">lin_grad</span><span class="p">(</span><span class="n">inp</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="n">inp</span><span class="o">.</span><span class="n">g</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">g</span> <span class="o">@</span> <span class="n">w</span><span class="o">.</span><span class="n">t</span><span class="p">()</span>
    <span class="n">w</span><span class="o">.</span><span class="n">g</span> <span class="o">=</span> <span class="p">(</span><span class="n">inp</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">out</span><span class="o">.</span><span class="n">g</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">b</span><span class="o">.</span><span class="n">g</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">g</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">softmax_cross_grad</span><span class="p">(</span><span class="n">inp</span><span class="p">,</span> <span class="n">targ</span><span class="p">):</span>
    <span class="n">targ</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">one_hot</span><span class="p">(</span><span class="n">targ</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">int64</span><span class="p">),</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">inp_s</span> <span class="o">=</span> <span class="n">softmax</span><span class="p">(</span><span class="n">inp</span><span class="p">)</span>
    <span class="n">inp</span><span class="o">.</span><span class="n">g</span> <span class="o">=</span> <span class="p">(</span> <span class="n">inp_s</span> <span class="o">-</span> <span class="n">targ</span> <span class="p">)</span> <span class="o">/</span> <span class="n">targ</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">full_pass</span><span class="p">(</span><span class="n">xb</span><span class="p">,</span> <span class="n">targ</span><span class="p">):</span>
    <span class="n">l1</span> <span class="o">=</span> <span class="n">linear</span><span class="p">(</span><span class="n">xb</span><span class="p">,</span> <span class="n">w1</span><span class="p">,</span> <span class="n">b1</span><span class="p">)</span>
    <span class="n">l1_r</span> <span class="o">=</span> <span class="n">relu</span><span class="p">(</span><span class="n">l1</span><span class="p">)</span>
    <span class="n">l2</span> <span class="o">=</span> <span class="n">linear</span><span class="p">(</span><span class="n">l1_r</span><span class="p">,</span> <span class="n">w2</span><span class="p">,</span> <span class="n">b2</span><span class="p">)</span>
    
    <span class="n">soft</span> <span class="o">=</span> <span class="n">softmax</span><span class="p">(</span><span class="n">l2</span><span class="p">)</span>
    
    <span class="n">loss</span> <span class="o">=</span> <span class="n">cross_entropy</span><span class="p">(</span><span class="n">soft</span><span class="p">,</span> <span class="n">targ</span><span class="p">)</span>
    
    <span class="n">softmax_cross_grad</span><span class="p">(</span><span class="n">l2</span><span class="p">,</span> <span class="n">targ</span><span class="p">)</span>
    <span class="n">lin_grad</span><span class="p">(</span><span class="n">l1_r</span><span class="p">,</span> <span class="n">l2</span><span class="p">,</span> <span class="n">w2</span><span class="p">,</span> <span class="n">b2</span><span class="p">)</span>
    <span class="n">rel_grad</span><span class="p">(</span><span class="n">l1</span><span class="p">,</span> <span class="n">l1_r</span><span class="p">)</span>
    <span class="n">lin_grad</span><span class="p">(</span><span class="n">xb</span><span class="p">,</span> <span class="n">l1</span><span class="p">,</span> <span class="n">w1</span><span class="p">,</span> <span class="n">b1</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">loss</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">full_pass</span><span class="p">(</span><span class="n">xt</span><span class="p">,</span> <span class="n">yt</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>tensor(2.4088)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Testing-vs-Pytorch-Gradient">Testing vs Pytorch Gradient<a class="anchor-link" href="#Testing-vs-Pytorch-Gradient">&#182;</a></h1>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">w1g</span> <span class="o">=</span> <span class="n">w1</span><span class="o">.</span><span class="n">g</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
<span class="n">w2g</span> <span class="o">=</span> <span class="n">w2</span><span class="o">.</span><span class="n">g</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
<span class="n">b1g</span> <span class="o">=</span> <span class="n">b1</span><span class="o">.</span><span class="n">g</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
<span class="n">b2g</span> <span class="o">=</span> <span class="n">b2</span><span class="o">.</span><span class="n">g</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
<span class="n">ig</span>  <span class="o">=</span> <span class="n">xt</span><span class="o">.</span><span class="n">g</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">xt2</span> <span class="o">=</span> <span class="n">xt</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span><span class="o">.</span><span class="n">requires_grad_</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">w12</span> <span class="o">=</span> <span class="n">w1</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span><span class="o">.</span><span class="n">requires_grad_</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">w22</span> <span class="o">=</span> <span class="n">w2</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span><span class="o">.</span><span class="n">requires_grad_</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">b12</span> <span class="o">=</span> <span class="n">b1</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span><span class="o">.</span><span class="n">requires_grad_</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">b22</span> <span class="o">=</span> <span class="n">b2</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span><span class="o">.</span><span class="n">requires_grad_</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">auto_full_pass</span><span class="p">(</span><span class="n">xb</span><span class="p">,</span> <span class="n">targ</span><span class="p">):</span>
    <span class="n">l1</span> <span class="o">=</span> <span class="n">linear</span><span class="p">(</span><span class="n">xb</span><span class="p">,</span> <span class="n">w12</span><span class="p">,</span> <span class="n">b12</span><span class="p">)</span>
    <span class="n">l1_r</span> <span class="o">=</span> <span class="n">relu</span><span class="p">(</span><span class="n">l1</span><span class="p">)</span>
    <span class="n">l2</span> <span class="o">=</span> <span class="n">linear</span><span class="p">(</span><span class="n">l1_r</span><span class="p">,</span> <span class="n">w22</span><span class="p">,</span> <span class="n">b22</span><span class="p">)</span>
    <span class="n">soft</span> <span class="o">=</span> <span class="n">softmax</span><span class="p">(</span><span class="n">l2</span><span class="p">)</span>
    
    <span class="n">loss</span> <span class="o">=</span> <span class="n">cross_entropy</span><span class="p">(</span><span class="n">soft</span><span class="p">,</span> <span class="n">targ</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">loss</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">loss</span> <span class="o">=</span> <span class="n">auto_full_pass</span><span class="p">(</span><span class="n">xt2</span><span class="p">,</span> <span class="n">yt</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_near</span><span class="p">(</span><span class="n">w22</span><span class="o">.</span><span class="n">grad</span><span class="p">,</span> <span class="n">w2g</span><span class="p">)</span>
<span class="n">test_near</span><span class="p">(</span><span class="n">b22</span><span class="o">.</span><span class="n">grad</span><span class="p">,</span> <span class="n">b2g</span><span class="p">)</span>
<span class="n">test_near</span><span class="p">(</span><span class="n">w12</span><span class="o">.</span><span class="n">grad</span><span class="p">,</span> <span class="n">w1g</span><span class="p">)</span>
<span class="n">test_near</span><span class="p">(</span><span class="n">b12</span><span class="o">.</span><span class="n">grad</span><span class="p">,</span> <span class="n">b1g</span><span class="p">)</span>
<span class="n">test_near</span><span class="p">(</span><span class="n">xt2</span><span class="o">.</span><span class="n">grad</span><span class="p">,</span> <span class="n">ig</span> <span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>good
good
good
good
good
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Refactoring">Refactoring<a class="anchor-link" href="#Refactoring">&#182;</a></h1>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="Module" class="doc_header"><code>class</code> <code>Module</code><a href="https://github.com/BradleyBrown19/ModernArchitecuturesFromScratch/tree/master/ModernArchitecuturesFromScratch/fully_connected_network_02.py#L54" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>Module</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="Linear" class="doc_header"><code>class</code> <code>Linear</code><a href="https://github.com/BradleyBrown19/ModernArchitecuturesFromScratch/tree/master/ModernArchitecuturesFromScratch/fully_connected_network_02.py#L65" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>Linear</code>(<strong><code>in_d</code></strong>, <strong><code>out_d</code></strong>, <strong><code>final</code></strong>) :: <a href="/ModernArchitecuturesFromScratch/TrainingLoop#Module"><code>Module</code></a></p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="ReLU" class="doc_header"><code>class</code> <code>ReLU</code><a href="https://github.com/BradleyBrown19/ModernArchitecuturesFromScratch/tree/master/ModernArchitecuturesFromScratch/fully_connected_network_02.py#L77" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>ReLU</code>() :: <a href="/ModernArchitecuturesFromScratch/TrainingLoop#Module"><code>Module</code></a></p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="CrossSoft" class="doc_header"><code>class</code> <code>CrossSoft</code><a href="https://github.com/BradleyBrown19/ModernArchitecuturesFromScratch/tree/master/ModernArchitecuturesFromScratch/fully_connected_network_02.py#L84" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>CrossSoft</code>() :: <a href="/ModernArchitecuturesFromScratch/TrainingLoop#Module"><code>Module</code></a></p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="Model" class="doc_header"><code>class</code> <code>Model</code><a href="https://github.com/BradleyBrown19/ModernArchitecuturesFromScratch/tree/master/ModernArchitecuturesFromScratch/fully_connected_network_02.py#L99" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>Model</code>(<strong><code>layers</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">layers</span> <span class="o">=</span> <span class="p">[</span><span class="n">Linear</span><span class="p">(</span><span class="mi">784</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span> <span class="n">ReLU</span><span class="p">(),</span> <span class="n">Linear</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span> <span class="kc">False</span><span class="p">)]</span>
<span class="n">loss_func</span> <span class="o">=</span> <span class="n">CrossSoft</span><span class="p">()</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">layers</span><span class="p">)</span>
<span class="n">loss</span> <span class="o">=</span> <span class="n">loss_func</span><span class="p">(</span><span class="n">model</span><span class="p">(</span><span class="n">xt</span><span class="p">),</span><span class="n">yt</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">loss_func</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">w1g</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">w</span><span class="o">.</span><span class="n">g</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
<span class="n">w2g</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">w</span><span class="o">.</span><span class="n">g</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
<span class="n">b1g</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">g</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
<span class="n">b2g</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">g</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
<span class="n">ig</span>  <span class="o">=</span> <span class="n">xt</span><span class="o">.</span><span class="n">g</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">xt</span> <span class="o">=</span> <span class="n">xt</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span><span class="o">.</span><span class="n">requires_grad_</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">w</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">w</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span><span class="o">.</span><span class="n">requires_grad_</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span><span class="o">.</span><span class="n">requires_grad_</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">w</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">w</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span><span class="o">.</span><span class="n">requires_grad_</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span><span class="o">.</span><span class="n">requires_grad_</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">time</span> loss = loss_func(model(xt), yt)
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>CPU times: user 209 ms, sys: 24.6 ms, total: 233 ms
Wall time: 58 ms
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">time</span> loss.backward()
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>CPU times: user 823 ms, sys: 48.8 ms, total: 872 ms
Wall time: 127 ms
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_near</span><span class="p">(</span><span class="n">w2g</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">w</span><span class="o">.</span><span class="n">grad</span><span class="p">)</span>
<span class="n">test_near</span><span class="p">(</span><span class="n">b2g</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">grad</span><span class="p">)</span>
<span class="n">test_near</span><span class="p">(</span><span class="n">w1g</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">w</span><span class="o">.</span><span class="n">grad</span><span class="p">)</span>
<span class="n">test_near</span><span class="p">(</span><span class="n">b1g</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">grad</span><span class="p">)</span>
<span class="n">test_near</span><span class="p">(</span><span class="n">ig</span><span class="p">,</span> <span class="n">xt</span><span class="o">.</span><span class="n">grad</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>good
good
good
good
good
</pre>
</div>
</div>

</div>
</div>

</div>
</div>
 

