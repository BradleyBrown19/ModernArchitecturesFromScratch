---

title: Title

keywords: fastai
sidebar: home_sidebar

summary: "summary"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: FullyConnectedNetwork.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
    
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Data-Loading">Data Loading<a class="anchor-link" href="#Data-Loading">&#182;</a></h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Initialization">Initialization<a class="anchor-link" href="#Initialization">&#182;</a></h1>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_weight" class="doc_header"><code>get_weight</code><a href="https://github.com/BradleyBrown19/ModernArchitecturesFromScratch/tree/master/ModernArchitecturesFromScratch/fully_connected_network_02.py#L13" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_weight</code>(<strong><code>in_d</code></strong>, <strong><code>out_d</code></strong>, <strong><code>relu_after</code></strong>)</p>
</blockquote>
<p>Returns weight matrix of size <code>in_d</code> x <code>out_d</code> initialized using Kaiming initialization</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>For full information of Kaiming initialization:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">get_weight</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>tensor([[ 0.2841, -0.9401, -0.4223, -0.7115,  0.5532],
        [-0.1580,  0.7566, -0.7379,  0.7424,  0.1979],
        [ 0.0763,  0.7963,  0.1251, -0.9009, -0.6070],
        [-0.2342, -0.1588,  1.0073, -0.2527, -0.7623]])</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Forward-Pass">Forward Pass<a class="anchor-link" href="#Forward-Pass">&#182;</a></h1>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="linear" class="doc_header"><code>linear</code><a href="https://github.com/BradleyBrown19/ModernArchitecturesFromScratch/tree/master/ModernArchitecturesFromScratch/fully_connected_network_02.py#L20" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>linear</code>(<strong><code>x</code></strong>, <strong><code>w</code></strong>, <strong><code>b</code></strong>)</p>
</blockquote>
<p>Basic linear layer</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="relu" class="doc_header"><code>relu</code><a href="https://github.com/BradleyBrown19/ModernArchitecturesFromScratch/tree/master/ModernArchitecturesFromScratch/fully_connected_network_02.py#L26" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>relu</code>(<strong><code>x</code></strong>)</p>
</blockquote>
<p>ReLU activation function</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="lin_rel" class="doc_header"><code>lin_rel</code><a href="https://github.com/BradleyBrown19/ModernArchitecturesFromScratch/tree/master/ModernArchitecturesFromScratch/fully_connected_network_02.py#L32" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>lin_rel</code>(<strong><code>x</code></strong>, <strong><code>w</code></strong>, <strong><code>b</code></strong>)</p>
</blockquote>
<p>Linear layer followed by ReLU activation on <code>x</code> with weight <code>w</code> and bias <code>b</code></p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="softmax" class="doc_header"><code>softmax</code><a href="https://github.com/BradleyBrown19/ModernArchitecturesFromScratch/tree/master/ModernArchitecturesFromScratch/fully_connected_network_02.py#L38" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>softmax</code>(<strong><code>x</code></strong>)</p>
</blockquote>
<p>Softmax activation function</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Loss">Loss<a class="anchor-link" href="#Loss">&#182;</a></h1>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="mse_loss" class="doc_header"><code>mse_loss</code><a href="https://github.com/BradleyBrown19/ModernArchitecturesFromScratch/tree/master/ModernArchitecturesFromScratch/fully_connected_network_02.py#L44" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>mse_loss</code>(<strong><code>xb</code></strong>, <strong><code>yb</code></strong>)</p>
</blockquote>
<p>Mean Square Error loss</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">eps</span> <span class="o">=</span> <span class="mf">1e-9</span>
<span class="c1">#hide</span>
<span class="k">def</span> <span class="nf">cross_entropy</span><span class="p">(</span><span class="n">xb</span><span class="p">,</span> <span class="n">targ</span><span class="p">):</span> 
    <span class="s2">&quot;Cross Entropy Loss&quot;</span>
    <span class="k">return</span> <span class="o">-</span><span class="p">(</span> <span class="p">(</span><span class="n">xb</span> <span class="o">+</span> <span class="n">eps</span><span class="p">)</span><span class="o">.</span><span class="n">log</span><span class="p">()[</span><span class="nb">range</span><span class="p">(</span><span class="n">targ</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">targ</span><span class="o">.</span><span class="n">long</span><span class="p">()]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Backwards-Pass">Backwards Pass<a class="anchor-link" href="#Backwards-Pass">&#182;</a></h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Testing-vs-Pytorch-Gradient">Testing vs Pytorch Gradient<a class="anchor-link" href="#Testing-vs-Pytorch-Gradient">&#182;</a></h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Refactoring">Refactoring<a class="anchor-link" href="#Refactoring">&#182;</a></h1>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="Module" class="doc_header"><code>class</code> <code>Module</code><a href="https://github.com/BradleyBrown19/ModernArchitecturesFromScratch/tree/master/ModernArchitecturesFromScratch/fully_connected_network_02.py#L49" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>Module</code>()</p>
</blockquote>
<p>Base class for every layer operation in a sequential network</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="Module.__call__" class="doc_header"><code>Module.__call__</code><a href="https://github.com/BradleyBrown19/ModernArchitecturesFromScratch/tree/master/ModernArchitecturesFromScratch/fully_connected_network_02.py#L51" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>Module.__call__</code>(<strong>*<code>args</code></strong>)</p>
</blockquote>
<p>Executes forward pass of module and stores result in <code>self.out</code> for backwards pass</p>

</div>

</div>

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="Module.forward" class="doc_header"><code>Module.forward</code><a href="https://github.com/BradleyBrown19/ModernArchitecturesFromScratch/tree/master/ModernArchitecturesFromScratch/fully_connected_network_02.py#L57" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>Module.forward</code>()</p>
</blockquote>
<p>Executes desired operation of module</p>

</div>

</div>

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="Module.backward" class="doc_header"><code>Module.backward</code><a href="https://github.com/BradleyBrown19/ModernArchitecturesFromScratch/tree/master/ModernArchitecturesFromScratch/fully_connected_network_02.py#L61" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>Module.backward</code>()</p>
</blockquote>
<p>Calls backwards method to find gradient with stored output of layer</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="Linear" class="doc_header"><code>class</code> <code>Linear</code><a href="https://github.com/BradleyBrown19/ModernArchitecturesFromScratch/tree/master/ModernArchitecturesFromScratch/fully_connected_network_02.py#L66" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>Linear</code>(<strong><code>in_d</code></strong>, <strong><code>out_d</code></strong>, <strong><code>final</code></strong>) :: <a href="/ModernArchitecturesFromScratch/ModelTraining#Module"><code>Module</code></a></p>
</blockquote>
<p>Base class for every layer operation in a sequential network</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="Linear.__init__" class="doc_header"><code>Linear.__init__</code><a href="https://github.com/BradleyBrown19/ModernArchitecturesFromScratch/tree/master/ModernArchitecturesFromScratch/fully_connected_network_02.py#L67" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>Linear.__init__</code>(<strong><code>in_d</code></strong>, <strong><code>out_d</code></strong>, <strong><code>final</code></strong>)</p>
</blockquote>
<p>Initialize weight using 'get_weight' and bias to 0 for linear operation</p>

</div>

</div>

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="Linear.forward" class="doc_header"><code>Linear.forward</code><a href="https://github.com/BradleyBrown19/ModernArchitecturesFromScratch/tree/master/ModernArchitecturesFromScratch/fully_connected_network_02.py#L71" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>Linear.forward</code>(<strong><code>xb</code></strong>)</p>
</blockquote>
<p>Perform forward linear pass</p>

</div>

</div>

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="Linear.bwd" class="doc_header"><code>Linear.bwd</code><a href="https://github.com/BradleyBrown19/ModernArchitecturesFromScratch/tree/master/ModernArchitecturesFromScratch/fully_connected_network_02.py#L75" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>Linear.bwd</code>(<strong><code>out</code></strong>, <strong><code>inp</code></strong>)</p>
</blockquote>
<p>Gradient with respect to the forward linear layer</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="ReLU" class="doc_header"><code>class</code> <code>ReLU</code><a href="https://github.com/BradleyBrown19/ModernArchitecturesFromScratch/tree/master/ModernArchitecturesFromScratch/fully_connected_network_02.py#L82" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>ReLU</code>() :: <a href="/ModernArchitecturesFromScratch/ModelTraining#Module"><code>Module</code></a></p>
</blockquote>
<p>Base class for every layer operation in a sequential network</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="ReLU.forward" class="doc_header"><code>ReLU.forward</code><a href="https://github.com/BradleyBrown19/ModernArchitecturesFromScratch/tree/master/ModernArchitecturesFromScratch/fully_connected_network_02.py#L83" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>ReLU.forward</code>(<strong><code>x</code></strong>)</p>
</blockquote>
<p>Set all activations to have a minimum of zero, subtract 0.5 to maintain mean of 0</p>

</div>

</div>

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="ReLU.bwd" class="doc_header"><code>ReLU.bwd</code><a href="https://github.com/BradleyBrown19/ModernArchitecturesFromScratch/tree/master/ModernArchitecturesFromScratch/fully_connected_network_02.py#L87" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>ReLU.bwd</code>(<strong><code>out</code></strong>, <strong><code>inp</code></strong>)</p>
</blockquote>
<p>Backward with respect to the ReLU layer</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="CrossSoft" class="doc_header"><code>class</code> <code>CrossSoft</code><a href="https://github.com/BradleyBrown19/ModernArchitecturesFromScratch/tree/master/ModernArchitecturesFromScratch/fully_connected_network_02.py#L93" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>CrossSoft</code>() :: <a href="/ModernArchitecturesFromScratch/ModelTraining#Module"><code>Module</code></a></p>
</blockquote>
<p>Base class for every layer operation in a sequential network</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="CrossSoft.forward" class="doc_header"><code>CrossSoft.forward</code><a href="https://github.com/BradleyBrown19/ModernArchitecturesFromScratch/tree/master/ModernArchitecturesFromScratch/fully_connected_network_02.py#L94" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>CrossSoft.forward</code>(<strong><code>inp</code></strong>, <strong><code>targ</code></strong>)</p>
</blockquote>
<p>Calls <code>soft_forward</code> and <code>cross_loss</code> on inp compared with <code>targ</code></p>

</div>

</div>

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="CrossSoft.soft_forward" class="doc_header"><code>CrossSoft.soft_forward</code><a href="https://github.com/BradleyBrown19/ModernArchitecturesFromScratch/tree/master/ModernArchitecturesFromScratch/fully_connected_network_02.py#L99" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>CrossSoft.soft_forward</code>(<strong><code>x</code></strong>)</p>
</blockquote>
<p>Implements softmax activation function on <code>x</code></p>

</div>

</div>

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="CrossSoft.cross_loss" class="doc_header"><code>CrossSoft.cross_loss</code><a href="https://github.com/BradleyBrown19/ModernArchitecturesFromScratch/tree/master/ModernArchitecturesFromScratch/fully_connected_network_02.py#L103" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>CrossSoft.cross_loss</code>(<strong><code>xb</code></strong>, <strong><code>targ</code></strong>)</p>
</blockquote>
<p>Cross entropy loss of <code>xb</code> compared to <code>targ</code></p>

</div>

</div>

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="CrossSoft.bwd" class="doc_header"><code>CrossSoft.bwd</code><a href="https://github.com/BradleyBrown19/ModernArchitecturesFromScratch/tree/master/ModernArchitecturesFromScratch/fully_connected_network_02.py#L107" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>CrossSoft.bwd</code>(<strong><code>loss</code></strong>, <strong><code>inp</code></strong>, <strong><code>targ</code></strong>)</p>
</blockquote>
<p>Gradient with respect to both softmax and cross entropy loss</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="Model" class="doc_header"><code>class</code> <code>Model</code><a href="https://github.com/BradleyBrown19/ModernArchitecturesFromScratch/tree/master/ModernArchitecturesFromScratch/fully_connected_network_02.py#L115" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>Model</code>(<strong><code>layers</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Testing-Output-and-Gradients">Testing Output and Gradients<a class="anchor-link" href="#Testing-Output-and-Gradients">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">layers</span> <span class="o">=</span> <span class="p">[</span><span class="n">Linear</span><span class="p">(</span><span class="mi">784</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span> <span class="n">ReLU</span><span class="p">(),</span> <span class="n">Linear</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span> <span class="kc">False</span><span class="p">)]</span>
<span class="n">loss_func</span> <span class="o">=</span> <span class="n">CrossSoft</span><span class="p">()</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">layers</span><span class="p">)</span>
<span class="n">loss</span> <span class="o">=</span> <span class="n">loss_func</span><span class="p">(</span><span class="n">model</span><span class="p">(</span><span class="n">xt</span><span class="p">),</span><span class="n">yt</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">loss_func</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">w1g</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">w</span><span class="o">.</span><span class="n">g</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
<span class="n">w2g</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">w</span><span class="o">.</span><span class="n">g</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
<span class="n">b1g</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">g</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
<span class="n">b2g</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">g</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
<span class="n">ig</span>  <span class="o">=</span> <span class="n">xt</span><span class="o">.</span><span class="n">g</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">xt</span> <span class="o">=</span> <span class="n">xt</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span><span class="o">.</span><span class="n">requires_grad_</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">w</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">w</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span><span class="o">.</span><span class="n">requires_grad_</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span><span class="o">.</span><span class="n">requires_grad_</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">w</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">w</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span><span class="o">.</span><span class="n">requires_grad_</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span><span class="o">.</span><span class="n">requires_grad_</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">time</span> loss = loss_func(model(xt), yt)
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>CPU times: user 201 ms, sys: 21.6 ms, total: 223 ms
Wall time: 55.9 ms
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">time</span> loss.backward()
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>CPU times: user 827 ms, sys: 50.6 ms, total: 878 ms
Wall time: 129 ms
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_near</span><span class="p">(</span><span class="n">w2g</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">w</span><span class="o">.</span><span class="n">grad</span><span class="p">)</span>
<span class="n">test_near</span><span class="p">(</span><span class="n">b2g</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">grad</span><span class="p">)</span>
<span class="n">test_near</span><span class="p">(</span><span class="n">w1g</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">w</span><span class="o">.</span><span class="n">grad</span><span class="p">)</span>
<span class="n">test_near</span><span class="p">(</span><span class="n">b1g</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">grad</span><span class="p">)</span>
<span class="n">test_near</span><span class="p">(</span><span class="n">ig</span><span class="p">,</span> <span class="n">xt</span><span class="o">.</span><span class="n">grad</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>good
good
good
good
good
</pre>
</div>
</div>

</div>
</div>

</div>
</div>
 

